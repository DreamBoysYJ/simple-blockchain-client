# P2P 패키지

이 패키지는 블록체인 네트워크에서 **Node Discovery**와 **P2P 통신 프로토콜**을 구현하며, 노드 간 통신을 가능하게 합니다.

---

## 네트워크 프로토콜

### 1. **Node Discovery**
Node Discovery는 **피어를 연결하기 전** 노드 정보를 검색하고 연결을 설정하는 초기 과정입니다.

- **프로세스**:
  1. 최초 실행 시, 하드코딩된 부트스트랩 노드와 UDP 통신. (`Ping`,`Pong`)
  2. 부트스트랩 노드로부터 피어 정보를 받아옴. (`FindNode`, `Neighbors`)
  3. 피어에게 UDP로 alive인지 체크(`Ping`,`Pong`), TCP 서버 정보 요청 (`ENRRequest`, `ENRResponse`)
  4. TCP 연결을 설정하여 본격적인 통신 준비.

- **Node Discovery 메시지 타입**:
  | 메시지 타입          | 코드  | 설명                             |
  |----------------------|-------|----------------------------------|
  | `Ping`               | `0x01`| 노드가 활성화되어 있는지 물음   |
  | `Pong`               | `0x02`| Ping 메시지에 대한 응답         |
  | `FindNode`           | `0x03`| 노드들의 정보를 요청           |
  | `Neighbors`          | `0x04`| 노드 목록을 반환           |
  | `ENRRequest`         | `0x05`| 노드의 TCP 서버 주소 요청|
  | `ENRResponse`        | `0x06`| 노드의 TCP 서버 주소 반환       |
<img width="1362" alt="node discovery 1" src="https://github.com/user-attachments/assets/9041d258-4c11-438f-ad61-2e45f5a936f8" />

---

### 2. **P2P**
P2P 프로토콜은 **피어와 연결된 후** 채팅, 트랜잭션과 블록 정보를 교환하는 통신 방식입니다.

- **프로세스**:
  - 노드 간 TCP 연결 후, **바이트 스트림**을 통해 데이터를 주고받습니다.
  - **첫 번째 바이트**로 메시지 타입을 식별:
    - `0x01`: 트랜잭션 메시지
    - `0x02`: 블록 메시지
    - `default`: 채팅
  - 나머지 데이터는 **JSON 직렬화** 형식으로 인코딩되어 처리됩니다.

- **P2P 메시지 타입**:
  | 메시지 타입          | 코드  | 설명                       |
  |----------------------|-------|----------------------------|
  | `TransactionMessage` | `0x01`| 트랜잭션 데이터 교환       |
  | `BlockMessage`       | `0x02`| 블록 데이터 교환           |
<img width="1710" alt="node discovery 2, p2p" src="https://github.com/user-attachments/assets/562a86c6-a8e0-40ee-ad70-9a0a08730af3" />

---

### 3. **프로토콜 공통 구조**
- 모든 프로토콜 메시지는 **첫 번째 바이트**로 식별됩니다.
  - Node Discovery와 P2P 프로토콜 모두 첫 번째 바이트를 통해 메시지 유형을 구분합니다.
- 첫 바이트 뒤에 오는 데이터는 **JSON 직렬화**를 사용해 처리됩니다.


---

## 주요 포인트
- **Node Discovery**는 피어 검색 및 연결 설정의 초기 단계로, UDP를 사용합니다.
- **P2P 프로토콜**은 트랜잭션과 블록 데이터를 효율적으로 교환하며 TCP를 사용합니다.
- **모든 메시지**는 첫 바이트로 메시지 타입을 식별하며, 데이터는 JSON 직렬화를 통해 전송됩니다.

